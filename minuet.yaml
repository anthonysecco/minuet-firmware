# MINUET FIRMWARE
#
# This is the ESPHome firmware configuration for Minuet.
# You are free to customize the firmware as you like.
#
# Refer to https://github.com/brown-studios/minuet-firmware for instructions.

# Give your device a name.
esphome:
  name: minuet
  friendly_name: Minuet
  comment: "Minuet fan controller"
  name_add_mac_suffix: true

# Configure the logger.
#
# Set `baud_rate` to 0 to disable serial port log output and improve performance.
# Set `baud_rate` to 921600 to enable serial port log output for debugging.
logger:
  level: DEBUG
  baud_rate: 0

# The configuration is organized into ESPHome packages that group related configuration
# elements together for ease of maintenance.  Follow the instructions in the comments
# to configure each package for your installation of Minuet.  You can comment out
# (or delete) sections that you don't need.
packages:
  ### PACKAGE COLLECTION: CORE
  #
  # Configures the hardware and implements core features.
  #
  # Variables:
  #   - Set `minuet_board_version` according to the silkscreen label on your
  #     Minuet circuit board, e.g. 'v3_0'.
  <<: !include
    file: minuet/core.yaml
    vars:
      minuet_board_version: 'v3_0'

  ### PACKAGE COLLECTION: ACCESSORIES
  #
  # If you have attached an accessory to the Minuet EXPANSION port, configure it here.
  # At most one accessory can be configured because there is only one port.
  # You can comment out this section if you have no accessories.
  #
  # Refer to the documentation in the files included from here.

  # Minuet light accessory with an addressable LED strip connected to it.
  <<: !include
    file: minuet/accessory/light/addressable.yaml
    vars:
      minuet_light_accessory_board_version: 'v3_0'
      minuet_led_strip: 'btf_sk6812_rgbw_60'

  # Minuet light accessory with a PWM dimmable light connected to it.
  # <<: !include
  #   file: minuet/accessory/light/dimmable.yaml
  #   vars:
  #     minuet_light_accessory_board_version: 'v3_0'

  ### PACKAGE: NETWORK
  #
  # In the default factory firmware, Minuet includes WiFi support and the WiFi radio
  # remains switched OFF until the user turns the WiFi radio ON.  When the WiFi radio
  # is ON, Minuet will attempt to connect to the WiFi network using the provided SSID
  # and password (if any).  If Minuet cannot connect after 1 minute, then it will start
  # its own access point using the built-in 'ap' credentials and it will serve a captive
  # portal to let the user provide the WiFi SSID and password.
  #
  # Here are some suggestions for customizing the network behavior.
  #
  # To completely disable the WiFi radio, comment out the entire `network` package
  # and the WiFi switch package to omit all WiFi functionality and keep the radio
  # OFF indefinitely.
  #
  # To require Minuet to connect to a specific WiFi network, uncomment the `networks`
  # section and provide the SSID and password for your WiFi network then comment out the
  # `ap` and `captive_portal` sections.  To improve security and reliability while traveling
  # or when you have integrated Minuet with Home Assistant, it's a good idea to require Minuet
  # to only ever connect to your own WiFi network.  Never expose Minuet to the public Internet!
  #
  # Of course, you can configure the network any way you like.
  minuet_network:
    # WiFi radio configuration
    # Refer to https://esphome.io/components/wifi/
    wifi:
      id: minuet_wifi
      power_save_mode: light
      # networks:
      #   - ssid: !secret wifi_ssid
      #   - password: !secret wifi_password
      # fast_connect: true
      ap:
        ssid: !secret minuet_access_point_ssid
        password: !secret minuet_access_point_password
        ap_timeout: 1min

    # Captive portal: asks you to provide WiFi credentials if none have been configured
    # Refer to https://esphome.io/components/captive_portal/
    captive_portal:

    # WiFi switch: lets you toggle the WiFi radio ON or OFF.
    # Comment out this package if you have removed the `wifi` component.
    #
    # Variables:
    #   - Set `minuet_wifi_default_state` to 'ON' or 'OFF'.
    <<: !include
      file: minuet/wifi-switch.yaml
      vars:
        minuet_wifi_default_state: 'OFF'

  ### PACKAGE: LOCAL NETWORK ACCESS
  #
  # These components allow Minuet to be accessed over the local network which is assumed
  # to be a private network.  Note that Minuet is not intended to be exposed to the public
  # Internet and it does not offer cloud services for remote access.
  #
  # The `ota` component lets Minuet accept authenticated over-the-air firmware updates.
  # Minuet firmware never updates itself automatically.  You can compile the firmware and
  # initiate an over-the-air software update using the ESPHome Builder.  To disable this
  # feature, comment out the `ota` section.
  #
  # The `api` component lets Minuet accept authenticated API requests from software on your
  # local network such as the ESPHome Builder and Home Assistant.  Use this to let these
  # programs control Minuet and retrieve logs.  To disable this feature, comment out the
  # `api` section.
  #
  # The `web_server` component lets you access the built-in web dashboard.  It is primarily
  # a debugging tool and you can use it to control the fan and read the logs.  It may be
  # useful for controlling the device from your phone if you aren't integrating Minuet
  # with Home Assistant.  Consider disabling `captive_portal` when you use `web_server`
  # because the captive portal can interfere with accessing the web server.
  minuet_access:
    # OTA component: accepts authenticated over-the-air firmware updates from the local network
    # Refer to https://esphome.io/components/ota/
    ota:
      - platform: esphome
        password: !secret minuet_over_the_air_update_password

    # API component: accepts authenticated API requests from the local network
    # Refer to https://esphome.io/components/api/
    api:
      reboot_timeout: 0s
      encryption:
        key: !secret minuet_api_encryption_key

    # Web server: lets you control Minuet and view logs from the local network
    # Refer to https://esphome.io/components/web_server/
    # web_server:
    #   local: true
    #   log: true
    #   version: 3

  ### PACKAGE: CUSTOM
  #
  # Declare components for any extra hardware that you have attached to Minuet.
  # Refer to https://esphome.io/components/
  my_package:
    sensor:
      # Example: SCD4x carbon dioxide, temperature, and relative humidity sensor
      # - platform: scd4x
      #   co2:
      #     name: 'Cabin CO2'
      #   temperature:
      #     name: 'Cabin Temperature'
      #   humidity:
      #     name: 'Cabin Humidity'
